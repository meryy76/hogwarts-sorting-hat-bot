<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Розподільний Капелюх — WebApp</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;700&display=swap" rel="stylesheet">
<style>
:root{--gold:#d3b36c;--paper:#f5e6c0;--glass:rgba(0,0,0,.55);--shadow:0 10px 30px #0006}
*{box-sizing:border-box;margin:0;padding:0}html,body{height:100%;overflow:hidden}body{font-family:'Cinzel',serif,system-ui,sans-serif;background:#000;color:#fff}
.screen{display:none;width:100%;height:100vh;position:relative}.show{display:block}button{cursor:pointer}
/* start - ОНОВЛЕНІ СТИЛІ */
#screen-start{background:url('https://www.dropbox.com/scl/fi/9hpl00fld42suyoje2w8q/16.10.25-20-48-17.jpg?rlkey=98tp7u328o2z75i2yfinsgjn9&raw=1') center/cover no-repeat;animation:fadein 1.2s ease;overflow:hidden;position:relative}
#screen-start::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg, rgba(90, 0, 150, 0.3) 0%, rgba(160, 0, 120, 0.25) 50%, rgba(200, 60, 0, 0.2) 100%);z-index:1}
#btn-start{position:absolute;left:50%;bottom:60px;transform:translateX(-50%);background:linear-gradient(135deg, #2a0b45 0%, #4a1b6b 50%, #6a2b8b 100%);color:#fff;border:2px solid var(--gold);padding:18px 40px;border-radius:16px;font-weight:700;letter-spacing:.06em;font-size:20px;text-shadow:0 0 15px rgba(255,255,255,0.7);box-shadow:0 0 30px rgba(160, 0, 200, 0.6), var(--shadow);transition:all 0.4s ease;z-index:10;animation:magicPulse 2.5s ease-in-out infinite}
#btn-start:hover{background:linear-gradient(135deg, #3a1b55 0%, #5a2b7b 50%, #7a3b9b 100%);transform:translateX(-50%) scale(1.08);box-shadow:0 0 40px rgba(200, 100, 255, 0.8), 0 10px 40px rgba(0,0,0,0.5);text-shadow:0 0 20px rgba(255,255,255,0.9)}

/* Кнопка управління музикою */
.music-control{position:absolute;top:20px;right:20px;background:rgba(20,12,0,.75);color:var(--paper);border:1px solid var(--gold);width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:100;transition:all 0.3s ease;font-size:18px}
.music-control:hover{background:rgba(40,25,5,.9);transform:scale(1.1)}

/* Нова анімація пульсації для кнопки */
@keyframes magicPulse{
  0%,100%{box-shadow:0 0 30px rgba(160, 0, 200, 0.6), var(--shadow);transform:translateX(-50%) scale(1);}
  50%{box-shadow:0 0 45px rgba(200, 100, 255, 0.8), 0 0 60px rgba(160, 60, 220, 0.4), var(--shadow);transform:translateX(-50%) scale(1.03);}
}

/* Анімація капелюха */
.hat-animation{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:2}
.hat-animation::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:url('https://www.dropbox.com/scl/fi/9hpl00fld42suyoje2w8q/16.10.25-20-48-17.jpg?rlkey=98tp7u328o2z75i2yfinsgjn9&raw=1') center/cover no-repeat;animation:hatSway 8s ease-in-out infinite}

/* Анімація свічок - оновлена з фіолетовими відтінками */
.candle-flicker{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;opacity:0.7;z-index:2}
.candle-flicker::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 30%, rgba(180, 70, 255, 0.4) 0%, transparent 50%), radial-gradient(circle at 80% 40%, rgba(130, 0, 200, 0.3) 0%, transparent 50%), radial-gradient(circle at 40% 70%, rgba(200, 100, 255, 0.35) 0%, transparent 50%);animation:candleFlicker 3s ease-in-out infinite alternate}

/* Магічні частинки на стартовому екрані */
.magic-particles{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:3}
.magic-particle{position:absolute;width:4px;height:4px;background:rgba(200, 150, 255, 0.8);border-radius:50%;filter:blur(1px);animation:magicFloat 8s linear infinite}

@keyframes hatSway{
  0%,100%{transform:rotate(0deg) scale(1);}
  25%{transform:rotate(0.5deg) scale(1.001);}
  50%{transform:rotate(-0.3deg) scale(1);}
  75%{transform:rotate(0.2deg) scale(1.002);}
}

@keyframes candleFlicker{
  0%,100%{opacity:0.5;filter:blur(1px);transform:scale(1);}
  25%{opacity:0.7;filter:blur(0.5px);transform:scale(1.02);}
  50%{opacity:0.6;filter:blur(0.8px);transform:scale(0.98);}
  75%{opacity:0.8;filter:blur(0.3px);transform:scale(1.01);}
}

@keyframes magicFloat{
  0%{transform:translateY(100vh) translateX(0) rotate(0deg);opacity:0}
  10%{opacity:0.8}
  90%{opacity:0.6}
  100%{transform:translateY(-100px) translateX(20px) rotate(180deg);opacity:0}
}

/* quiz */
#screen-quiz{background:url('https://www.dropbox.com/scl/fi/q3leze43a80byj0w29nrf/17.10.25-12-56-05.jpg?rlkey=4cuc8f2bfxtklvf773i29zm0z&st=3ectporj&dl=1') center/cover no-repeat;position:relative;overflow:hidden}
.quiz{width:min(920px,94vw);margin:0 auto;padding:48px 18px 24px;background:rgba(0,0,0,.65);backdrop-filter:blur(5px);border-radius:12px;box-shadow:var(--shadow);border:1px solid rgba(211,179,108,0.3);position:relative;z-index:2}
.badge{display:inline-block;padding:.38rem .7rem;border:1px solid #ffffff2a;border-radius:999px;font-size:13px;color:#ddd;background:#00000042}
.progress{height:6px;background:#1c1b28;border-radius:999px;overflow:hidden;margin:14px 0 22px}
.bar{height:100%;width:0;background:linear-gradient(90deg,#c6a66b,#e5d5a3);transition:width .35s ease}
.q{font-size:clamp(20px,2.8vw,28px);margin:8px 0 18px;text-shadow:0 2px 8px #0008;line-height:1.35}
.answers{display:grid;gap:10px}@media(min-width:640px){.answers{grid-template-columns:1fr 1fr}}
.answers button{background:#ffffff14;color:#fff;border:1px solid #ffffff28;padding:15px;border-radius:12px;font-size:16px;text-align:left;transition:all .15s ease;backdrop-filter:blur(2px)}
.answers button:hover{background:#ffffff28;border-color:#ffffff40;transform:translateY(-1px)}
.answers button:active{transform:scale(.985)}

/* Магічні анімації для екрану питань */
.magic-candles{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1}
.flying-candle{position:absolute;font-size:24px;animation:flyingCandle 8s linear infinite;opacity:0;filter:drop-shadow(0 0 8px rgba(255,200,100,0.8))}
.flying-wand{position:absolute;font-size:28px;animation:flyingWand 6s linear infinite;opacity:0;filter:drop-shadow(0 0 10px rgba(100,200,255,0.8))}
.flying-broom{position:absolute;font-size:22px;animation:flyingBroom 10s linear infinite;opacity:0;filter:drop-shadow(0 0 6px rgba(200,100,255,0.8))}

@keyframes flyingCandle{
  0%{transform:translateX(-50px) translateY(100vh) rotate(0deg);opacity:1}
  20%{opacity:0.8}
  80%{opacity:0.6}
  100%{transform:translateX(calc(100vw + 100px)) translateY(-100px) rotate(360deg);opacity:0}
}

@keyframes flyingWand{
  0%{transform:translateX(100vw) translateY(50vh) rotate(0deg);opacity:1}
  30%{opacity:0.9}
  70%{opacity:0.7}
  100%{transform:translateX(-100px) translateY(calc(100vh + 100px)) rotate(-720deg);opacity:0}
}

@keyframes flyingBroom{
  0%{transform:translateX(50vw) translateY(-50px) rotate(0deg);opacity:1}
  25%{opacity:0.8}
  75%{opacity:0.6}
  100%{transform:translateX(calc(100vw - 100px)) translateY(calc(100vh + 50px)) rotate(180deg);opacity:0}
}

/* result - ОНОВЛЕНІ СТИЛІ */
#screen-result{background:#000;background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;padding:20px;overflow:hidden;position:relative}
.result{width:min(920px,94vw);padding:24px;border-radius:18px;background:var(--glass);border:1px solid #ffffff24;box-shadow:0 20px 60px #0008;text-align:center;position:relative;z-index:2;animation:fadein 1.1s ease}
.crest{width:120px;height:120px;margin:0 auto 12px;border-radius:50%;object-fit:cover;border:3px solid var(--gold);box-shadow:0 0 30px rgba(211,179,108,0.5), 0 0 60px rgba(211,179,108,0.3);background:#000;animation:crestGlow 3s ease-in-out infinite alternate}
.hat-quote{font-size:clamp(18px,2.8vw,24px);font-weight:700;letter-spacing:.03em;margin:8px 0 16px;min-height:60px;display:flex;align-items:center;justify-content:center;text-shadow:0 0 15px currentColor;animation:fadeInText 1.5s ease}
.desc{color:#eee;line-height:1.5;margin:12px 0 16px;font-size:clamp(14px,1.8vw,16px);animation:fadeInText 2s ease}
.tags{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;margin-bottom:16px;animation:fadeInText 2.5s ease}
.tag{border:1px solid #ffffff40;border-radius:999px;padding:6px 12px;font-size:12px;color:#f0f0f0;background:linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));backdrop-filter:blur(10px);box-shadow:0 2px 8px rgba(0,0,0,0.3)}
.famous{color:#f3f3ff;font-size:14px;opacity:.85;margin-bottom:16px;animation:fadeInText 3s ease}
.founder-history{color:#ddd;font-size:13px;line-height:1.4;margin:12px 0;padding:12px;background:rgba(0,0,0,0.3);border-radius:8px;border-left:2px solid var(--gold);animation:fadeInText 3.5s ease}
.history-toggle{background:transparent;color:var(--gold);border:1px solid var(--gold);padding:6px 12px;border-radius:6px;font-size:12px;margin-top:8px;cursor:pointer;transition:all 0.3s ease}
.history-toggle:hover{background:rgba(211,179,108,0.1)}
.actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:20px}
.common-room-btn{padding:14px 32px;border-radius:14px;font-weight:700;border:1px solid transparent;transition:all .3s;font-size:16px;background:linear-gradient(135deg, #2a0b45 0%, #4a1b6b 50%, #6a2b8b 100%);color:#fff;border:2px solid var(--gold);text-shadow:0 0 10px rgba(255,255,255,0.7);box-shadow:0 0 25px rgba(160, 0, 200, 0.5), var(--shadow);animation:primaryPulse 3s ease-in-out infinite}
.common-room-btn:hover{background:linear-gradient(135deg, #3a1b55 0%, #5a2b7b 50%, #7a3b9b 100%);transform:scale(1.05);box-shadow:0 0 35px rgba(200, 100, 255, 0.7), 0 10px 30px rgba(0,0,0,0.4);text-shadow:0 0 15px rgba(255,255,255,0.9)}
.hogwarts-btn{padding:14px 32px;border-radius:14px;font-weight:700;border:1px solid transparent;transition:all .3s;font-size:16px;background:linear-gradient(135deg, #1e3a1e 0%, #2d5a2d 50%, #3c7a3c 100%);color:#fff;border:2px solid #4CAF50;text-shadow:0 0 10px rgba(255,255,255,0.7);box-shadow:0 0 25px rgba(76, 175, 80, 0.5), var(--shadow)}
.hogwarts-btn:hover{background:linear-gradient(135deg, #2d4a2d 0%, #3c6a3c 50%, #4b8a4b 100%);transform:scale(1.05);box-shadow:0 0 35px rgba(76, 175, 80, 0.7), 0 10px 30px rgba(0,0,0,0.4);text-shadow:0 0 15px rgba(255,255,255,0.9)}

/* Нова анімація для кнопки на екрані результатів */
@keyframes primaryPulse{
  0%,100%{box-shadow:0 0 25px rgba(160, 0, 200, 0.5), var(--shadow);transform:scale(1);}
  50%{box-shadow:0 0 35px rgba(200, 100, 255, 0.7), 0 0 50px rgba(160, 60, 220, 0.3), var(--shadow);transform:scale(1.02);}
}

/* Нові анімації */
@keyframes crestGlow{
  0%{box-shadow:0 0 20px rgba(211,179,108,0.4), 0 0 40px rgba(211,179,108,0.2);}
  100%{box-shadow:0 0 30px rgba(211,179,108,0.6), 0 0 60px rgba(211,179,108,0.4);}
}

@keyframes fadeInText{
  0%{opacity:0;transform:translateY(10px);}
  100%{opacity:1;transform:translateY(0);}
}

@keyframes hatWhisper{
  0%{opacity:0;transform:scale(0.8) translateY(10px);}
  100%{opacity:1;transform:scale(1) translateY(0);}
}

.hat-whisper{animation:hatWhisper 1.5s ease-out;color:var(--gold);text-shadow:0 0 20px currentColor}

/* magic */
.magic{position:absolute;inset:0;overflow:hidden;z-index:1;pointer-events:none}
.spark{position:absolute;width:3px;height:3px;background:#fff8d4;border-radius:50%;opacity:.75;filter:blur(1px);animation:rise 8s linear infinite}
.glow{position:absolute;inset:-20%;background:radial-gradient(60% 40% at 50% 80%,#fff2 0%,#0000 60%);mix-blend-mode:screen;opacity:.35;animation:pulse 6s ease-in-out infinite}
@keyframes rise{0%{transform:translateY(100vh) scale(.5);opacity:0}10%{opacity:.95}90%{opacity:.7}100%{transform:translateY(-10vh) scale(1.1);opacity:0}}
@keyframes fadein{from{opacity:0}to{opacity:1}}
@keyframes pulse{0%,100%{opacity:.25}50%{opacity:.45}}

/* Адаптація для iPhone 13 Pro та інших мобільних */
@media (max-width: 390px) and (max-height: 845px) {
  .result{padding:20px 16px;margin:10px;}
  .crest{width:100px;height:100px;margin-bottom:10px;}
  .hat-quote{min-height:50px;margin:6px 0 12px;font-size:16px;}
  .desc{margin:10px 0 14px;font-size:14px;}
  .tags{margin-bottom:12px;}
  .tag{padding:4px 10px;font-size:11px;}
  .famous{font-size:13px;margin-bottom:12px;}
  .founder-history{font-size:12px;padding:10px;margin:10px 0;}
  .actions{gap:8px;margin-top:16px;}
  .common-room-btn,.hogwarts-btn{padding:12px 24px;font-size:15px;}
  #btn-start{padding:16px 32px;font-size:18px;}
}

/* Прибираємо скрол на всіх екранах */
html, body {overflow:hidden; touch-action:pan-y;}
.screen {overflow:hidden;}
</style>
</head>
<body>
<!-- Аудіо елемент для фонової музики -->
<audio id="background-music" loop>
  <source src="https://www.dropbox.com/scl/fi/m8ckie2mqoym9uy731ap0/21071.mp3?rlkey=i153x2jt5gnv96pxt44am1aee&st=7jiu3jaj&dl=1" type="audio/mpeg">
</audio>

<section id="screen-start" class="screen show">
  <div class="music-control" id="music-toggle">🎵</div>
  <div class="hat-animation"></div>
  <div class="candle-flicker"></div>
  <div class="magic-particles" id="magic-particles"></div>
  <button id="btn-start">ПОЧАТИ РОЗПОДІЛ</button>
</section>

<section id="screen-quiz" class="screen">
  <div class="music-control" id="music-toggle-quiz">🎵</div>
  <div class="magic-candles" id="magic-candles"></div>
  <div class="quiz">
    <div class="badge" id="badge">Питання 1 з 15</div>
    <div class="progress"><div class="bar" id="bar"></div></div>
    <h2 id="q" class="q"></h2>
    <div id="answers" class="answers"></div>
  </div>
</section>

<section id="screen-result" class="screen">
  <div class="music-control" id="music-toggle-result">🎵</div>
  <div class="magic" id="magic"><div class="glow"></div></div>
  <div class="result">
    <img id="crest" class="crest" alt="Герб факультету">
    <div id="hat-quote" class="hat-quote"></div>
    <p id="desc" class="desc"></p>
    <div id="tags" class="tags"></div>
    <div id="famous" class="famous"></div>
    <div id="founder-container" style="display:none;">
      <div id="founder-history" class="founder-history"></div>
      <button class="history-toggle" id="history-toggle">Сховати історію</button>
    </div>
    <div class="actions">
      <button class="common-room-btn" id="common-room">Перейти до вітальні</button>
      <button class="hogwarts-btn" id="hogwarts">Вернутись в Хогвартс</button>
    </div>
  </div>
</section>

<script>
/* ===== ДАНІ ФАКУЛЬТЕТІВ ===== */
const HOUSES={
 GRYF:{name:"Ґрифіндор",emoji:"🦁",
  bg:"url('https://www.dropbox.com/scl/fi/4esz69ihrjdbf4fswvo3w/17.10.25-11-41-53-1.jpg?rlkey=s6qmem824w5mmvibi0cxka7v2&st=map12ioh&dl=1')",
  crest:"https://www.dropbox.com/scl/fi/wq1w5euk7troiavp1uz23/17.10.25-10-59-23.jpg?rlkey=anpi8o66dl9wbiarq3gd893na&st=i15lk6sz&dl=1",
  desc:"Факультет хоробрих, благородних і чесних. Тут цінують сміливість, честь і вірність друзям.",
  quote:"Капелюх задумливо мовчить… і раптом шепоче: Ґрифіндор!",
  tags:["сміливість","честь","вірність"],
  famous:"Гаррі Поттер, Герміона Ґрейнджер, Альбус Дамблдор",
  founder:"Ґодрик Ґрифіндор — один з найвеличніших чарівників свого часу, знаний своєю хоробрістю та лицарськими ідеалами. Він вірив, що справжня сила полягає у сміливості захищати те, що дороге, і завжди стояти на боці справедливості.",
  commonRoomLink:"https://t.me/+CAkrFyriIoMxZTcy"},
 SLY:{name:"Слизерин",emoji:"🐍",
  bg:"url('https://www.dropbox.com/scl/fi/vj0cuyhbhrv7dofby3xhe/17.10.25-11-41-54-1.jpg?rlkey=q365bh83moqwk04ku1b73yn1u&st=vmbqth1t&dl=1')",
  crest:"https://www.dropbox.com/scl/fi/s7q8vp6ktf6bhlspdoyt3/17.10.25-11-01-35.jpg?rlkey=8113zkmyl2m6qu8weg9vm1bjf&st=5wdbwdq3&dl=1",
  desc:"Факультет амбіцій, хитрість і рішучості. Його учні далекоглядні і не бояться ризику.",
  quote:"Капелюх задумливо мовчить… і раптом шепоче: Слизерин!",
  tags:["амбіції","хитрість","рішучість"],
  famous:"Северус Снейп, Драко Мелфой, Том Реддл",
  founder:"Салазар Слизерин — могутній чарівник, що цінував чистоту крові та амбіції. Він вірив, що лише чарівники з чистокровних сімей гідні навчатися магії, і створив Таємну кімнату для захисту спадщини Гоґвортсу.",
  commonRoomLink:"https://t.me/+-tH9MjRQPVcxMzQy"},
 RAV:{name:"Ґрейнджой",emoji:"🪄",
  bg:"url('https://www.dropbox.com/scl/fi/ba0c6lr5hpsf85fsow91b/17.10.25-11-41-54.jpg?rlkey=m4qjusu6zyz1131x734dgmkbq&st=fvmxhmkc&dl=1')",
  crest:"https://www.dropbox.com/scl/fi/7l0044yjn3kqfopqs06ns/17.10.25-12-35-07.jpg?rlkey=35hprzmarxy1x2wja1usrtpq6&st=bgswes52&dl=1",
  desc:"Тут цінують розум, мудрість і творче мислення. Студенти спостережливі та винахідливі.",
  quote:"Капелюх задумливо мовчить… і раптом шепоче: Ґрейнджой!",
  tags:["розум","мудрість","винахідливість"],
  famous:"Луна Лавґуд, Філіус Флітвік, Чжоу Чанг",
  founder:"Кандіда Ґрейнджой — одна з найблискучіших чарівниць свого часу, відома своєю мудрістю та творчим підходом до магії. Вона створила мінливу планування Гоґвортсу і вірила, що знання — найвеличніший скарб.",
  commonRoomLink:"https://t.me/+kLfeWTJL47g1MzUy"},
 HUF:{name:"Гафелпаф",emoji:"🦡",
  bg:"url('https://www.dropbox.com/scl/fi/k1k7nfnw0zcqdbzyzrwhu/17.10.25-11-41-53.jpg?rlkey=zqa6sw1ccikq4flbxg9xdenal&st=b21sphcl&dl=1')",
  crest:"https://www.dropbox.com/scl/fi/madd7q6kf6az57f9xgufx/17.10.25-10-59-23-1.jpg?rlkey=fhd78lqxhnxodcq3uaefazzf9&st=dfdedqiy&dl=1",
  desc:"Найдобріші і працьовиті. Тут навчають вірності, чесності та турботи про інших.",
  quote:"Капелюх задумливо мовчить… і раптом шепоче: Гафелпаф!",
  tags:["доброта","працьовитість","вірність"],
  famous:"Німфадора Тонкс, Седрик Діггорі, Помона Спраут",
  founder:"Пенелопа Гафелпаф — добра і справедлива чарівниця, відома своєю турботою про всі живі істоти. Вона створила систему домашніх ельфів Гоґвортсу і вірила, що працьовитість і вірність — основа справжньої магії.",
  commonRoomLink:"https://t.me/+hvSVxAXuMARlZmUy"}
};

/* ===== ПИТАННЯ (15) ===== */
const QUESTIONS=[
{q:"Коли ти стоїш перед невідомим — що відчуваєш перш за все?",a:{А:["Цікавість","RAV"],Б:["Азарт","GRYF"],В:["Обережність","HUF"],Г:["Недовіру","SLY"]}},
{q:"Тобі пропонують силу, але за неї потрібно заплатити чимось важливим. Що ти зробиш?",a:{А:["Прийму — усе має ціну","SLY"],Б:["Відмовлюся, мені і так вистачає","HUF"],В:["Спробую обійти умови","RAV"],Г:["Візьму, якщо це заради мети","GRYF"]}},
{q:"Якби в тебе була можливість стерти одне спогад, ти б це зробив?",a:{А:["Так, не все варто пам'ятати","HUF"],Б:["Ні, минуле робить мене тим, ким я є","GRYF"],В:["Лише якщо воно заважає рухатися далі","RAV"],Г:["Навіщо стирати, якщо можна використати?","SLY"]}},
{q:"Ти йдеш темним коридором і чуєш крик. Що зробиш?",a:{А:["Побіжу на звук","GRYF"],Б:["Обережно перевірю","RAV"],В:["Сховаюся і поспостерігаю","SLY"],Г:["Покличу когось на допомогу","HUF"]}},
{q:"Якщо хтось користується твоєю добротою, ти…",a:{А:["Проучу його","SLY"],Б:["Просто віддалюся","HUF"],В:["Спробую зрозуміти причину","RAV"],Г:["Зроблю вигляд, що не помітив","GRYF"]}},
{q:"Ти дізнаєшся чиюсь таємницю. Що далі?",a:{А:["Збережу в секреті","HUF"],Б:["Зачекаю, поки це знадобиться","SLY"],В:["Скажу тому, кому це може нашкодити","GRYF"],Г:["Розповім, якщо це врятує когось","RAV"]}},
{q:"Що тобі простіше — пробачити чи забути?",a:{А:["Пробачити","HUF"],Б:["Забути","RAV"],В:["Ні те, ні інше","SLY"],Г:["Все залежить від людини","GRYF"]}},
{q:"Коли хтось кращий за тебе, ти…",a:{А:["Вчуся у нього","RAV"],Б:["Намагаюся обігнати","GRYF"],В:["Радію його успіху","HUF"],Г:["Не показую, що це мене зачіпає","SLY"]}},
{q:"Ти отримав владу, але ніхто не знає про це. Що ти зробиш?",a:{А:["Буду використовувати її обережно","RAV"],Б:["Знайду, де вона принесе користь","HUF"],В:["Сховаю — таємниця надійніша за силу","SLY"],Г:["Протестую її на ділі","GRYF"]}},
{q:"Якщо друг зрадив тебе, що сильніше — біль чи злість?",a:{А:["Біль","HUF"],Б:["Злість","SLY"],В:["Розчарування","RAV"],Г:["Розуміння","GRYF"]}},
{q:"Що для тебе означає слово «честь»?",a:{А:["Вірність собі","GRYF"],Б:["Правила, яких не можна порушувати","HUF"],В:["Ілюзія, створена суспільством","SLY"],Г:["Захист тих, хто дорогий","RAV"]}},
{q:"Ти знаходиш стару книгу, повну небезпечних знань. Що ти зробиш?",a:{А:["Вивчу, незважаючи на ризик","RAV"],Б:["Сховаю подалі","HUF"],В:["Використаю, якщо доведеться","SLY"],Г:["Поділюся з тим, хто мудріший","GRYF"]}},
{q:"Якщо дають вибір між легким шляхом і правильним, що вибереш?",a:{А:["Правильний, навіть якщо боляче","GRYF"],Б:["Легкий — навіщо ускладнювати","SLY"],В:["Той, що залежить від мети","RAV"],Г:["Той, де зможу допомогти іншим","HUF"]}},
{q:"Яку якість ти цінуєш у собі найбільше?",a:{А:["Спокій","HUF"],Б:["Сміливість","GRYF"],В:["Терпіння","RAV"],Г:["Вміння бачити суть","SLY"]}},
{q:"Коли ніхто не дивиться — ким ти є насправді?",a:{А:["Тим, хто втомився прикидатися","HUF"],Б:["Тим, хто весь час шукає","RAV"],В:["Тим, хто знає більше, ніж показує","SLY"],Г:["Тим, хто просто хоче спокою","GRYF"]}}
];

/* ===== ЛОГІКА ===== */
let i=0,score={GRYF:0,SLY:0,RAV:0,HUF:0};
const sStart=document.getElementById('screen-start'),sQuiz=document.getElementById('screen-quiz'),sRes=document.getElementById('screen-result');
const qEl=document.getElementById('q'),ans=document.getElementById('answers'),bar=document.getElementById('bar'),badge=document.getElementById('badge');
const crestEl = document.getElementById('crest');
const magicCandles = document.getElementById('magic-candles');
const magicParticles = document.getElementById('magic-particles');
const backgroundMusic = document.getElementById('background-music');
const hatQuoteEl = document.getElementById('hat-quote');
const founderContainer = document.getElementById('founder-container');
const founderHistory = document.getElementById('founder-history');
const historyToggle = document.getElementById('history-toggle');
const commonRoomBtn = document.getElementById('common-room');
const hogwartsBtn = document.getElementById('hogwarts');

// Змінна для зберігання поточного факультету
let currentHouse = null;

// Управління музикою
let isMusicPlaying = false;

function toggleMusic() {
    if (isMusicPlaying) {
        backgroundMusic.pause();
        document.querySelectorAll('.music-control').forEach(btn => btn.innerHTML = '🔇');
    } else {
        backgroundMusic.play().catch(e => console.log('Автовідтворення заблоковано'));
        document.querySelectorAll('.music-control').forEach(btn => btn.innerHTML = '🎵');
    }
    isMusicPlaying = !isMusicPlaying;
}

// Ініціалізація кнопок музики
document.querySelectorAll('.music-control').forEach(btn => {
    btn.onclick = toggleMusic;
});

document.getElementById('btn-start').onclick=start;
commonRoomBtn.onclick=goToCommonRoom;
hogwartsBtn.onclick=()=>window.open('https://t.me/hogwarts_online_official', '_blank');

// Управління історією засновника
historyToggle.onclick = function() {
    if (founderContainer.style.display === 'none') {
        founderContainer.style.display = 'block';
        historyToggle.textContent = 'Сховати історію';
    } else {
        founderContainer.style.display = 'none';
        historyToggle.textContent = 'Показати історію';
    }
};

// Створення магічних частинок на стартовому екрані
function createMagicParticles() {
  for(let i = 0; i < 25; i++) {
    const particle = document.createElement('div');
    particle.className = 'magic-particle';
    particle.style.left = Math.random() * 100 + 'vw';
    particle.style.top = Math.random() * 100 + 'vh';
    particle.style.animationDelay = (Math.random() * 8) + 's';
    particle.style.width = (2 + Math.random() * 4) + 'px';
    particle.style.height = particle.style.width;
    magicParticles.appendChild(particle);
  }
}

function start(){
  sStart.classList.remove('show');
  sQuiz.classList.add('show');
  i=0;
  score={GRYF:0,SLY:0,RAV:0,HUF:0};
  startMagicAnimations();
  
  // Автоматично вмикаємо музику при початку тесту
  if (!isMusicPlaying) {
    backgroundMusic.volume = 0.4;
    toggleMusic();
  }
  
  render();
}

function startMagicAnimations() {
  // Створюємо літаючі магічні об'єкти
  const magicObjects = [
    {class: 'flying-candle', emoji: '🕯️', count: 8},
    {class: 'flying-wand', emoji: '⚡', count: 5},
    {class: 'flying-broom', emoji: '🧹', count: 3}
  ];
  
  magicCandles.innerHTML = '';
  
  magicObjects.forEach(obj => {
    for(let k = 0; k < obj.count; k++) {
      const element = document.createElement('div');
      element.className = obj.class;
      element.innerHTML = obj.emoji;
      element.style.left = Math.random() * 100 + 'vw';
      element.style.top = Math.random() * 100 + 'vh';
      element.style.animationDelay = (Math.random() * 10) + 's';
      element.style.fontSize = (20 + Math.random() * 15) + 'px';
      magicCandles.appendChild(element);
    }
  });
}

function render(){
  const q=QUESTIONS[i],total=QUESTIONS.length;
  badge.textContent=`Питання ${i+1} з ${total}`; bar.style.width=`${(i/total)*100}%`;
  qEl.textContent=q.q; ans.innerHTML='';
  for(const [ukLetter,[t,h]] of Object.entries(q.a)){
    const b=document.createElement('button'); 
    b.innerHTML=`<strong>${ukLetter}.</strong> ${t}`;
    b.onclick=()=>{score[h]++;next();}; 
    ans.appendChild(b);
  }
}
function next(){ if(++i<QUESTIONS.length) render(); else finish(); }

function finish(){
  sQuiz.classList.remove('show'); 
  sRes.classList.add('show');
  const houseKey=Object.entries(score).sort((a,b)=>b[1]-a[1])[0][0];
  currentHouse = HOUSES[houseKey];
  
  sRes.style.backgroundImage=currentHouse.bg;
  
  // Вставляємо герб факультету в золоте коло
  crestEl.src = currentHouse.crest;
  crestEl.alt = `Герб ${currentHouse.name}`;
  
  // Ховаємо історію за замовчуванням
  founderContainer.style.display = 'none';
  founderHistory.textContent = currentHouse.founder;
  historyToggle.textContent = 'Показати історію';
  
  // Спочатку показуємо інтригуюче повідомлення
  hatQuoteEl.textContent = "Капелюх задумливо мовчить...";
  hatQuoteEl.className = "hat-quote";
  
  document.getElementById('desc').textContent=currentHouse.desc;
  const tags=document.getElementById('tags'); tags.innerHTML=''; currentHouse.tags.forEach(t=>{const s=document.createElement('span');s.className='tag';s.textContent=t;tags.appendChild(s)});
  document.getElementById('famous').textContent=`Відомі особистості: ${currentHouse.famous}`;
  spawnMagic(42);
  
  // Через 1.5 секунди показуємо результат з анімацією шепоту
  setTimeout(() => {
    hatQuoteEl.textContent = currentHouse.quote;
    hatQuoteEl.classList.add("hat-whisper");
  }, 1500);
  
  if(window.Telegram&&Telegram.WebApp){Telegram.WebApp.ready();Telegram.WebApp.sendData(JSON.stringify({house:currentHouse.name,score}))}
}

function goToCommonRoom() {
  if (currentHouse && currentHouse.commonRoomLink) {
    window.open(currentHouse.commonRoomLink, '_blank');
  }
}

function spawnMagic(n=30){
  const magic=document.getElementById('magic'); magic.querySelectorAll('.spark').forEach(e=>e.remove());
  for(let k=0;k<n;k++){const s=document.createElement('div'); s.className='spark'; s.style.left=Math.random()*100+'vw'; s.style.bottom='-10vh'; s.style.animationDelay=(Math.random()*8)+'s'; s.style.opacity=(.3+Math.random()*.7).toFixed(2); magic.appendChild(s);}
}

// Ініціалізація при завантаженні
document.addEventListener('DOMContentLoaded', function() {
    backgroundMusic.volume = 0.4;
    createMagicParticles();
});
</script>
</body>
</html>
